<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Color Project</title>

    <head>

    <body>
        <header>
            <h1>Color picker</h1>
            <p>Test</p>
            <p>Test 2</p>
            <p>test 3</p>
        </header>

        <main>
            <!--needs link to other page-->
            <a href="page.html"><button type="button" class="button button1">Add link to results</button></a>

        </main>

        <!--<div id="parent"></div>-->
        <section>
            <h2 id="prompt">Select your favorite color</h2>
            <div id="fixed"></div>
        </section>

        <script src="https://unpkg.com/vanilla-picker@2"></script>
        <script>
            let state = 1;

            function $(selector) { return document.querySelector(selector); }

            var parent = document.querySelector('#parent');
            var picker = new Picker(parent);


            picker.onChange = function (color) {
                //parent.style.background = color.rgbaString;
                colorCallback(color)
                //pickedcolor = color.rgbaString;
                console.log(color);
            };
            picker.onDone = function (color) {

            };

            const parentFixed = $('#fixed'),
                pickerFixed = new Picker({
                    parent: parentFixed,
                    popup: false,
                    alpha: false,
                    editor: false,
                    color: 'black',
                    onChange: function (color) {
                        parentFixed.style.backgroundColor = color.rgbaString;
                    },
                    onDone: function (color) {

                        if (state === 1) {
                            console.log(color._rgba);
                            const UserFavRed = color._rgba[0];
                            console.log(UserFavRed);

                            const UserFavGreen = color._rgba[1];
                            console.log(UserFavGreen);

                            const UserFavBlue = color._rgba[2];
                            console.log(UserFavBlue);
                            $("#prompt").innerHTML = "Select your least favorite color";
                            state++;
                            console.log(state);
                        }
                        else {
                            console.log(color._rgba);
                            const UserLeastFavRed = color._rgba[0];
                            console.log(UserLeastFavRed);

                            const UserLeastFavGreen = color._rgba[1];
                            console.log(UserLeastFavGreen);

                            const UserLeastFavBlue = color._rgba[2];
                            console.log(UserLeastFavBlue);



                            console.log("doing the redirect");
                            //get the most recent average for the database
                            //make the new average and post it to the database
                            //add code to show that the user submitted. Use localstorage?
                        }
                        //getting last average from the database
                        const mysql = require("mysql");

                        const connection = require("./config/connection");

                        var returnedFavRed;
                        var returnedFavGreen;
                        var returnedFavBlue;
                        var returnedLeastFavRed;
                        var returnedLeastFavGreen;
                        var returnedLeastFavBlue;

                        function getLastAverage() {
                            const query = "SELECT * FROM `colors` WHERE id=(SELECT MAX(id) FROM `colors`)";
                            connection.query(query, function (err, res) {
                                if (err) throw err;
                                console.log(res);
                                //declaring the response values?
                                returnedFavRed = res.fav_red_ave;
                                returnedFavGreen = res.fav_green_ave;
                                returnedFavBlue = res.fav_blue_ave;
                                returnedLeastFavRed = res.least_fav_red_ave;
                                returnedLeastFavGreen = res.least_fav_green_ave;
                                returnedLeastFavBlue = res.least_fav_blue_ave;
                                //total number of previous entries to get new average
                                const totalPrevEntries = res.id;


                            });

                        }
                    }
                });
            pickerFixed.setColor('black', true);




        </script>
        <script>


            function changeBackground() {

                const x = Math.floor(Math.random() * 256);
                const y = Math.floor(Math.random() * 256);
                const z = Math.floor(Math.random() * 256);
                const bgColor1 = "rgb(" + x + "," + y + "," + z + ")";
                console.log(bgColor1);
                const a = Math.floor(Math.random() * 256);
                const b = Math.floor(Math.random() * 256);
                const c = Math.floor(Math.random() * 256);
                const bgColor2 = "rgb(" + a + "," + b + "," + c + ")";
                console.log(bgColor2);

                document.body.style.background = `linear-gradient(${bgColor1}, ${bgColor2})`;
            }
            changeBackground();

        </script>
    </body>

</html>